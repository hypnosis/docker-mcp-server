# ü§î –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –≤–æ–ø—Ä–æ—Å: –∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ñ–∏–ª–µ–π

## –ü–†–û–ë–õ–ï–ú–ê

–ú—ã —Å—Ç–æ–ª–∫–Ω—É–ª–∏—Å—å —Å –ø—Ä–æ–±–ª–µ–º–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ñ–∏–ª–µ–π –≤ Node.js ES –º–æ–¥—É–ª–µ.

### –ö–æ–Ω—Ç–µ–∫—Å—Ç

1. **–ü—Ä–æ–µ–∫—Ç:** Docker MCP Server (TypeScript + ES modules)
2. **–ó–∞–¥–∞—á–∞:** –ó–∞–≥—Ä—É–∂–∞—Ç—å SSH –ø—Ä–æ—Ñ–∏–ª–∏ –∏–∑ JSON —Ñ–∞–π–ª–∞ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ MCP
3. **–§–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:** `~/.docker-mcp/profiles.json`
4. **–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è:** `DOCKER_MCP_PROFILES_FILE=~/.docker-mcp/profiles.json`

### –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

```typescript
// src/utils/profile-resolver.ts
export function resolveProfile(profile?: string): SSHConfig | null {
  const profilesFile = process.env.DOCKER_MCP_PROFILES_FILE; // "~/.docker-mcp/profiles.json"
  
  // –ü—Ä–æ–±–ª–µ–º–∞ 1: ~ –Ω–µ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è Node.js
  const fileResult = loadProfilesFile(profilesFile);
  
  // –ü—Ä–æ–±–ª–µ–º–∞ 2: require() –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ ES modules
  const { loadProfilesFile } = require('./profiles-file.js'); // ‚ùå –û—à–∏–±–∫–∞
}
```

## –í–û–ü–†–û–°–´

### 1. require() vs import() –≤ ES –º–æ–¥—É–ª—è—Ö

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç ES modules (`"type": "module"` –≤ package.json)
- `require()` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- `import()` –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π, –Ω–æ `resolveProfile()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –∏–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –º–µ—Å—Ç

**–í–∞—Ä–∏–∞–Ω—Ç—ã:**
- A) –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `import()` –∏ —Å–¥–µ–ª–∞—Ç—å –≤—Å—é —Ü–µ–ø–æ—á–∫—É –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π (17+ –º–µ—Å—Ç –≤ –∫–æ–¥–µ)
- B) –ó–∞–≥—Ä—É–∂–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞ –∏ –∫–µ—à–∏—Ä–æ–≤–∞—Ç—å (–Ω–æ –Ω—É–∂–Ω–∞ "hot reload"?)
- C) –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `createRequire()` –∏–∑ `module` –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –≤ ES –º–æ–¥—É–ª–µ
- D) –î—Ä—É–≥–æ–π –ø–æ–¥—Ö–æ–¥?

**–í–æ–ø—Ä–æ—Å:** –ö–∞–∫–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –ù–ê–î–ï–ñ–ù–ï–ï –∏ –ü–†–û–©–ï –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏?

### 2. –†–∞—Å–∫—Ä—ã—Ç–∏–µ —Ç–∏–ª—å–¥—ã `~` –≤ –ø—É—Ç—è—Ö

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `process.env.DOCKER_MCP_PROFILES_FILE` —Å–æ–¥–µ—Ä–∂–∏—Ç `~/.docker-mcp/profiles.json`
- Node.js –Ω–µ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç `~` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ù—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –∑–∞–º–µ–Ω—è—Ç—å `~` –Ω–∞ `process.env.HOME`

**–í–∞—Ä–∏–∞–Ω—Ç—ã:**
- A) –†–∞—Å–∫—Ä—ã–≤–∞—Ç—å `~` –≤ –∫–æ–¥–µ: `profilesFile.replace('~', process.env.HOME)`
- B) –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ –ø—É—Ç–∏ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è
- C) –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É —Ç–∏–ø–∞ `expand-tilde` –∏–ª–∏ `os.homedir()`
- D) –î—Ä—É–≥–æ–π –ø–æ–¥—Ö–æ–¥?

**–í–æ–ø—Ä–æ—Å:** –ö–∞–∫–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –Ω–∞–¥–µ–∂–Ω–µ–µ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –≤—Å–µ—Ö –û–° (macOS, Linux, Windows)?

### 3. –ì–¥–µ —Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø—Ä–æ—Ñ–∏–ª–µ–π?

**–¢–µ–∫—É—â–µ–µ —Ä–µ—à–µ–Ω–∏–µ:** `~/.docker-mcp/profiles.json`

**–í–∞—Ä–∏–∞–Ω—Ç—ã:**
- A) `~/.docker-mcp/profiles.json` (—Ç–µ–∫—É—â–∏–π)
- B) `~/.config/docker-mcp/profiles.json` (XDG standard)
- C) `$XDG_CONFIG_HOME/docker-mcp/profiles.json` (Linux —Å—Ç–∞–Ω–¥–∞—Ä—Ç)
- D) `%APPDATA%/docker-mcp/profiles.json` (Windows)
- E) –í—Å–µ –≤—ã—à–µ —Å fallback —Ü–µ–ø–æ—á–∫–æ–π

**–í–æ–ø—Ä–æ—Å:** –ö–∞–∫–æ–µ –º–µ—Å—Ç–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç best practices –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞–¥–µ–∂–Ω–æ –Ω–∞ –≤—Å–µ—Ö –û–°?

### 4. –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `resolveProfile()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –ö–ê–ñ–î–û–ú MCP –∑–∞–ø—Ä–æ—Å–µ
- –ó–∞–≥—Ä—É–∂–∞—Ç—å —Ñ–∞–π–ª –∫–∞–∂–¥—ã–π —Ä–∞–∑ - –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ
- –ù–æ –Ω—É–∂–Ω–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏–∑–º–µ–Ω—è—Ç—å –ø—Ä–æ—Ñ–∏–ª–∏ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞

**–í–∞—Ä–∏–∞–Ω—Ç—ã:**
- A) –ó–∞–≥—Ä—É–∂–∞—Ç—å –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ, –∫–µ—à–∏—Ä–æ–≤–∞—Ç—å, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞—Ç—å –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö (fs.watch)
- B) –ó–∞–≥—Ä—É–∂–∞—Ç—å –ø—Ä–∏ –∫–∞–∂–¥–æ–º –≤—ã–∑–æ–≤–µ (—Ç–µ–∫—É—â–∏–π –ø–æ–¥—Ö–æ–¥)
- C) –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å –∫–µ—à–µ–º –∏ TTL
- D) –î—Ä—É–≥–æ–π –ø–æ–¥—Ö–æ–¥?

**–í–æ–ø—Ä–æ—Å:** –ö–∞–∫–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –±–∞–ª–∞–Ω—Å–∏—Ä—É–µ—Ç –º–µ–∂–¥—É –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –∏ –≥–∏–±–∫–æ—Å—Ç—å—é?

## –¢–†–ï–ë–û–í–ê–ù–ò–Ø

1. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:** –î–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ, –±–µ–∑ race conditions
2. **–ü—Ä–æ—Å—Ç–æ—Ç–∞:** –ú–∏–Ω–∏–º—É–º —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –≤ –∫–æ–¥–µ
3. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –ù–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å MCP –∑–∞–ø—Ä–æ—Å—ã
4. **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:** macOS, Linux, Windows
5. **–û—Ç–ª–∞–¥–∫–∞:** –õ–µ–≥–∫–æ –ø–æ–Ω—è—Ç—å, —á—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫

## –ü–†–ò–ú–ï–† –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø

```typescript
// –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ MCP tool handlers (17+ –º–µ—Å—Ç)
async handleList(args: any) {
  const sshConfig = resolveProfile(args?.profile); // –°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –∏–ª–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ?
  const containerManager = new ContainerManager(sshConfig);
  return containerManager.listContainers(...);
}
```

## –°–¢–†–£–ö–¢–£–†–ê –ö–û–ù–§–ò–ì–ê

```json
{
  "default": "local",
  "profiles": {
    "local": {
      "mode": "local"
    },
    "zaicylab": {
      "host": "109.172.39.241",
      "username": "root",
      "port": 22,
      "privateKeyPath": "~/.ssh/id_rsa",
      "projectsPath": "/var/www"
    }
  }
}
```

---

**–ù—É–∂–µ–Ω —Å–æ–≤–µ—Ç –æ—Ç Opus:** –ö–∞–∫ –ª—É—á—à–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ —Ä–µ—à–∏—Ç—å —ç—Ç–∏ –≤–æ–ø—Ä–æ—Å—ã –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ–π –∏ –ø—Ä–æ—Å—Ç–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏?
